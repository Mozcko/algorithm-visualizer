---
// src/components/common/Sidebar.astro
import type { AlgorithmDefinition } from '../../algorithms/types';

// 1. Escanear todos los archivos .ts dentro de algorithms
// Nota: Astro.glob es la forma nativa de importar archivos dinÃ¡micamente
const algorithmsImport = import.meta.glob('../../algorithms/**/*.ts', { eager: true });

// 2. Procesar y Agrupar los datos
const algorithms = Object.values(algorithmsImport)
  .map((module: any) => module.default as AlgorithmDefinition)
  .filter((algo) => algo && algo.category); // Filtramos archivos que no sean algoritmos (ej: types.ts)

const groupedAlgorithms = algorithms.reduce((acc, algo) => {
  if (!acc[algo.category]) acc[algo.category] = [];
  acc[algo.category].push(algo);
  return acc;
}, {} as Record<string, AlgorithmDefinition[]>);

const { currentId } = Astro.props;
---

<aside class="w-64 bg-slate-900 h-screen text-slate-300 flex flex-col border-r border-slate-700">
  <div class="border-b border-slate-700 font-bold text-white tracking-wider">
    <a href="/" class="block p-4 hover:text-blue-400 transition-colors">
      ALGO_VISUALIZER
    </a>
  </div>
  
  <nav class="flex-1 overflow-y-auto py-4">
    {Object.entries(groupedAlgorithms).map(([category, algos]) => {
      const isCategoryOpen = algos.some(algo => algo.id === currentId);
      return (
        <details class="mb-2 group" open={isCategoryOpen}>
          <summary class="px-4 py-2 text-xs font-semibold text-slate-500 uppercase tracking-widest cursor-pointer hover:text-slate-300 flex justify-between items-center list-none outline-none select-none">
            <span>{category}</span>
            <svg 
              class="w-3 h-3 transition-transform duration-200 transform group-open:rotate-180" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </summary>
          <ul class="mt-1">
            {algos.map((algo) => (
              <li>
                <a 
                  href={`/${algo.category.toLowerCase()}/${algo.id}`}
                  class:list={[
                    "block px-4 py-2 text-sm hover:bg-slate-800 hover:text-white transition-colors border-l-2",
                    algo.id === currentId 
                      ? "border-blue-500 bg-slate-800 text-white" 
                      : "border-transparent"
                  ]}
                >
                  {algo.name}
                </a>
              </li>
            ))}
          </ul>
        </details>
      );
    })}
  </nav>
</aside>